<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="referrer" content="no-referrer-when-downgrade" />
  <title>Continue to Offer</title>

  <!-- Optional: helps with caching behaviour on some webviews -->
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
  <meta http-equiv="Pragma" content="no-cache" />

  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      margin: 0;
      background-color: #f5f5f7;
    }

    .wrap {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .card {
      max-width: 520px;
      width: 100%;
      border: 1px solid #e5e5e5;
      border-radius: 14px;
      padding: 18px;
    }

    h1 {
      font-size: 18px;
      margin: 0 0 10px;
    }

    p {
      margin: 0 0 14px;
      line-height: 1.4;
      color: #333;
    }

    button {
      width: 100%;
      border: 0;
      border-radius: 12px;
      padding: 14px 16px;
      font-size: 16px;
      cursor: pointer;
      background-color: #007aff;
      color: white;
      font-weight: 500;
    }

    button:hover {
      background-color: #0051d5;
    }

    .button-group {
      display: flex;
      gap: 10px;
    }

    .button-group button {
      flex: 1;
    }

    .close-btn {
      background-color: #e5e5e5;
      color: #333;
    }

    .close-btn:hover {
      background-color: #d1d1d1;
    }

    .zbd-btn {
      background-color: #00c853;
      color: white;
    }

    .zbd-btn:hover {
      background-color: #00a844;
    }

    .version {
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-size: 12px;
      color: #999;
      font-family: monospace;
    }

    .load-time {
      position: fixed;
      bottom: 10px;
      left: 10px;
      font-size: 12px;
      color: #999;
      font-family: monospace;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>Ready to Continue?</h1>
      <p>Click the button below to proceed to your offer.</p>
      <div class="button-group">
        <button id="close" class="close-btn">Close</button>
        <button id="zbd" class="zbd-btn">Open ZBD</button>
        <button id="go">Continue</button>
      </div>
    </div>
  </div>

  <div class="version">v1.1.0</div>
  <div class="load-time" id="loadTime"></div>

  <script>
    // Display load time with second granularity
    const loadTime = new Date();
    const timeString = loadTime.toLocaleString('en-US', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: true
    });
    document.getElementById('loadTime').textContent = `Loaded: ${timeString}`;

    // Your Everflow tracking link
    const TRACKING_URL = "https://www.kaoh7u3o.com/4RQSJ/23JF6C/?appId=fumb.bitcoin.blocks&rewardsUserId=361ffb21-6817-4433-9042-a0ba6a261a8f&sub4=361ffb21-6817-4433-9042-a0ba6a261a8f&sub5=fumb.bitcoin.blocks";


    // Redirect when button is clicked
    function redirectToOffer() {
      window.location.href = TRACKING_URL;
    }

    // Open ZBD app
    function openZBD() {
      window.location.href = "zbd://";
    }

    // Detect platform
    function detectPlatform() {
      const userAgent = navigator.userAgent.toLowerCase();
      if (/android/.test(userAgent)) {
        return 'android';
      } else if (/iphone|ipad|ipod/.test(userAgent)) {
        return 'ios';
      } else if (/mac/.test(userAgent)) {
        return 'mac';
      } else if (/win/.test(userAgent)) {
        return 'windows';
      }
      return 'unknown';
    }

    // Close function with platform detection
    function closeWindow() {
      const payload = { type: 'close' };
      const messageString = JSON.stringify(payload);
      const platform = detectPlatform();

      if (platform === 'android') {
        if (window.AndroidInterface && typeof window.AndroidInterface.postMessage === 'function') {
          window.AndroidInterface.postMessage(messageString);
        } else {
          console.error('Failed to post Android Message');
        }
      } else if (platform === 'windows' || platform === 'mac') {
        if (typeof window.postMessageToUnity === 'function') {
          window.postMessageToUnity(messageString);
        }
      } else {
        try {
          window?.webkit?.messageHandlers?.iOSInterface?.postMessage(messageString);
        } catch (err) {
          console.error('Failed to post IOS Message');
        }
      }
    }

    // Attach click handlers
    document.getElementById("go").addEventListener("click", redirectToOffer);
    document.getElementById("zbd").addEventListener("click", openZBD);
    document.getElementById("close").addEventListener("click", closeWindow);
  </script>
</body>

</html>